<!DOCTYPE html>
<html>
<head>
  <title>Upload Video - ZKG Live</title>
</head>

<body>

<h2>Upload Video</h2>

<!-- Video Preview -->
<video id="preview" width="320" controls style="display:none;"></video>
<br><br>

<input type="text" id="title" placeholder="Video Title"><br><br>

<textarea id="description" placeholder="Video Description" rows="4" cols="40"></textarea><br><br>

<input type="text" id="tags" placeholder="Tags (comma separated)"><br><br>

<input type="file" id="videoFile" accept="video/*"><br><br>

<button onclick="uploadVideo()">Upload</button>

<p id="status"></p>
<progress id="progressBar" value="0" max="100" style="width:300px; display:none;"></progress>
<p id="percent"></p>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCKqRPWM-3C5N-mPAN1lMf_m9CedLIfVSQ",
  authDomain: "zkg-live.firebaseapp.com",
  projectId: "zkg-live",
  storageBucket: "zkg-live.appspot.com",
  appId: "1:1013280789722:web:8a561f796c6fda205b01e3"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();
const storage = firebase.storage();

/* Preview */
document.getElementById("videoFile").addEventListener("change", function () {
  const file = this.files[0];
  if (file) {
    const video = document.getElementById("preview");
    video.src = URL.createObjectURL(file);
    video.style.display = "block";
  }
});

function uploadVideo() {
  const title = document.getElementById("title").value;
  const description = document.getElementById("description").value;
  const tags = document.getElementById("tags").value;
  const file = document.getElementById("videoFile").files[0];

  if (!title || !file) {
    alert("Title aur video zaroori hai");
    return;
  }

  const progressBar = document.getElementById("progressBar");
  const percentText = document.getElementById("percent");

  progressBar.style.display = "block";
  progressBar.value = 0;
  percentText.innerText = "0%";

  const ref = storage.ref("videos/" + Date.now() + "_" + file.name);
  const uploadTask = ref.put(file);

  uploadTask.on("state_changed",
    snapshot => {
      const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
      progressBar.value = progress;
      percentText.innerText = Math.floor(progress) + "% uploaded";
    },
    error => {
      document.getElementById("status").innerText = "âŒ ERROR: " + error.message;
    },
    () => {
      uploadTask.snapshot.ref.getDownloadURL().then(url => {
        return db.collection("videos").add({
          title,
          description,
          tags,
          url,
          time: firebase.firestore.FieldValue.serverTimestamp()
        });
      }).then(() => {
        document.getElementById("status").innerText = "âœ… Video Uploaded Successfully!";
        percentText.innerText = "100% Completed ðŸŽ‰";
      });
    }
  );
}
</script>

</body>
</html>
